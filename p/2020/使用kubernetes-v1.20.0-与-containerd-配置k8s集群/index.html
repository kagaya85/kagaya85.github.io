<!DOCTYPE html>
<html lang="zh-cn">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤ å†™åœ¨å‰é¢ Kubernetesåœ¨æœ€æ–°çš„1.20.0ç‰ˆæœ¬ä¸­è¡¨ç¤ºæ­£å¼æ”¾å¼ƒäº†Dockerï¼ŒåŸæ¥çš„Dockeré¡¹ç›®ä¹Ÿæ—©å·²æ”¹åä¸ºMobyäº†ï¼Œå³ä¾¿Dockeråœ¨å®¹å™¨æŠ€æœ¯ä¸­ä»å æ®ä¸»æµï¼Œå¹¶ä¸”åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å¤Ÿç»§ç»­å‘å…‰å‘çƒ­ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œå®¹å™¨è¿è¡Œæ—¶å¿…ç„¶ä¹Ÿä¼šè¿›å…¥ä¸€ä¸ªå¤šæ–¹ç«äº‰çš„æ—¶ä»£ã€‚å¯¹äºé€‚é…äº†Kubernetes CRIçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Containerdå’ŒCRI-Oã€‚Dockerç›®å‰å æ®äº†çº¦ä¸ƒæˆçš„ä»½é¢ï¼Œè€Œç¬¬äºŒåContainerdä¹Ÿå æ®äº†ä¸¤æˆå¤šã€‚åˆšå¥½å®éªŒå®¤æœ‰æ­å»ºé›†ç¾¤çš„éœ€æ±‚ï¼Œä½œä¸ºçˆ±æŠ˜è…¾æ˜Ÿäººï¼Œå†³å®šç´§è·Ÿæ—¶ä»£ï¼Œç”¨æœ€æ–°çš„V1.20.0çš„Kubernetesä¸Containerdæ¥æ­å»ºæˆ‘ä»¬çš„å®éªŒé›†ç¾¤ã€‚æˆ‘ä¼šç®€å•è®²è§£æˆ‘çš„é…ç½®è¿‡ç¨‹ä»¥åŠä¸­é—´é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼Œæ¯•ç«Ÿè‡ªå·±è¸©è¿‡çš„å‘ï¼Œå¾—è®²ä¸€éæ‰èƒ½è®°å¾—æ·±åˆ»ï¼ˆç¬‘ï¼‰
æœ¬æ–‡æ‰€éœ€shellè„šæœ¬éƒ½åœ¨è¿™ä¸ªrepoï¼Œå¦‚æœä¹‹åæœ‰éœ€è¦ä¹Ÿä¼šä¸æ–­æ›´æ–°ï¼Œå¯¹äºé…ç½®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é—®é¢˜æ¬¢è¿åœ¨issueä¸­è®¨è®ºã€‚
é…ç½®åŸºæœ¬ç¯å¢ƒ è¿™æ¬¡æ‰“ç®—åœ¨å››å°è£¸æœºä¸Šéƒ¨ç½²ä¸€ä¸ªå•masterèŠ‚ç‚¹ï¼Œä¸‰ä¸ªworkerèŠ‚ç‚¹çš„å°é›†ç¾¤ï¼Œå•æœºé…ç½®å¦‚ä¸‹ï¼š
 CleanShot_2020-12-18_at_21.54.34@2x 
å½“ç„¶è¿™æ˜¯æˆ‘éƒ¨ç½²å¥½åçš„æˆªå›¾ï¼Œä¸»æœºçš„åç§°ä¹Ÿæ”¹ä¸ºäº†ip&#43;nodeTypeï¼Œæ–¹ä¾¿è¯†åˆ«å½“å‰ä¸»æœºï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å¿…é¡»ä¿®æ”¹çš„ï¼Œå› ä¸ºåŸæ¥çš„å››å°ä¸»æœºçš„ä¸»æœºåéƒ½ä¸ºlocalhost.localdomainï¼ŒåŒåä¸»æœºåœ¨å»ºç«‹é›†ç¾¤åä¸èƒ½ä¸€èµ·æ˜¾ç¤ºï¼Œè¿™ä¹Ÿæ˜¯é…ç½®æ—¶é‡åˆ°çš„å‘ä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŒæ ·å°†æ”¹åçš„å‘½ä»¤åˆ†åˆ«å†™åœ¨äº†04_pull_master_images.shä¸04_pull_worker_images.shï¼Œå¯ä»¥è‡ªåŠ¨å®ç°å°†ä¸»æœºåæ›¿æ¢ä¸ºip&#43;nodeTypeï¼Œå½“ç„¶ï¼Œè¿™éƒ½æ˜¯åè¯äº†ã€‚
æœ¬æ¬¡ä¸»è¦æ˜¯åœ¨CentOS7ä¸‹è¿›è¡Œé…ç½®ï¼Œè¦æ±‚èƒ½è¿æ¥å¤–ç½‘ï¼Œå¯¹äºkubernetséœ€è¦çš„k8s.gcr.ioä¸Šçš„é•œåƒæˆ‘ä¹Ÿå·²ç»åœ¨é˜¿é‡Œäº‘ä¸ŠåŒæ­¥äº†ä¸€ä»½ï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‚ä»£ç†çš„è¦æ±‚ã€‚å½“ç„¶æœ€å¥½è¿˜æ˜¯åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œä¸ä¿è¯érootç”¨æˆ·çš„æ‰§è¡Œæ•ˆæœï¼ˆå¯å¢åŠ sudoå°è¯•ï¼‰
å¯¹äºæ¯ä¸€å°æœºå™¨ï¼Œåªéœ€è¦ä¸€æ¬¡æ‰§è¡Œ00ï½02å¯¹åº”è„šæœ¬
# cdè¿›å…¥è„šæœ¬å¯¹åº”ç›®å½• bash 00_install_tools.sh bash 01_config_env.sh bash 02_install_kube.sh   00å®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ï¼Œå¦‚gitã€vimã€unzipã€ntpdateç­‰ï¼Œå®‰è£…äº†yum epelå¹¶å¯¹yumè¿›è¡Œäº†æ¢æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›å¸¸ç”¨çš„å·¥å…·å¦‚zshã€neofetchã€htopç­‰ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†shellåˆ‡æ¢ä¸ºzshï¼ˆâš ï¸æ³¨æ„ï¼Œåæ–‡çš„è„šæœ¬éƒ½æ˜¯åŸºäºä¿®æ”¹~/.zshrcæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨zshï¼Œè¯·å¯¹åº”ä¿®æ”¹ä¸º~/.bashrcæˆ–~./bash_profileï¼‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åšä¿®æ”¹ã€‚
  01è®¾ç½®äº†ä¸€äº›åŸºæœ¬ç¯å¢ƒé…ç½®ï¼Œå…³é—­firewalldå’Œswapï¼Œè®¾ç½®äº†iptableè½¬å‘ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶é—´è¿›è¡ŒåŒæ­¥ï¼Œå¹¶ä¿®æ”¹ä¸ºCSTæ—¶åŒºï¼Œä¿è¯å„ä¸ªä¸»æœºä¸Šæ—¶é—´çš„ä¸€è‡´æ€§å¯¹é›†ç¾¤çš„é…ç½®ä¹Ÿè‡³å…³é‡è¦ã€‚
  02ä¸ºyumæ·»åŠ äº†Kubernetesçš„repoï¼Œå®‰è£…äº†1.20.0ç‰ˆæœ¬çš„kubeletã€kubeadmã€kubectlä¸‰ä»¶å¥—
  å®‰è£…Containerd æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€å°ä¸»æœºå®‰è£…Containerdæ›¿æ¢ä¹‹å‰çš„Dockerã€‚
ä¸€é”®å®‰è£…ï¼š
bash 03_install_containerd.sh Containerdçš„å®˜æ–¹quick-startæ–‡æ¡£ä¼šé»˜è®¤ä½ å·²ç»å®‰è£…äº†runcï¼ˆContainerdé»˜è®¤çš„å®¹å™¨è¿è¡Œå·¥å…·ï¼‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬è¿˜æ˜¯è¦å®‰è£…runcï¼Œå¦åˆ™å°†æ— æ³•è¿è¡Œå®¹å™¨ã€‚
æˆ‘ä»¬ç›´æ¥é€‰æ‹©æ‹‰å–runcçš„å®˜æ–¹ä»“åº“è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œruncæ¯”è¾ƒå°ï¼Œç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯éœ€è¦æœ‰goçš„è¿è¡Œç¯å¢ƒå’Œlibseccomp ã€libseccomp-develä¸¤ä¸ªé“¾æ¥åº“ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚è¿™äº›éƒ½åœ¨è„šæœ¬ä¸­å®‰è£…å¥½äº†ï¼Œå¦‚æœä½ ä¸æƒ³ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°$PATHå¯¹åº”çš„ç›®å½•ä¸­å³å¯ã€‚
# install runc git clone https://github.com/opencontainers/runc cd runc &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install è¿™æ ·å°±å®‰è£…å¥½äº†runcå·¥å…·
å®‰è£…Containerdä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸‹è½½å®˜æ–¹ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…ï¼Œè§£å‹å¯¹åº”ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿé€‰æ‹©äº†è¾ƒæ–°çš„1.4.3ç‰ˆæœ¬ï¼Œç”šè‡³å®˜æ–¹ä»“åº“çš„release tagé‡Œè¿˜æ˜¯1.3.9ç‰ˆæœ¬
CONTAINERD_VERSION=1.4.3 wget https://github.com/containerd/containerd/releases/download/v&amp;#34;$CONTAINERD_VERSION&amp;#34;/containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz tar -xvf containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz -C /usr/local/ æ¥ä¸‹æ¥å°±æ˜¯æ¯”è¾ƒå…³é”®ä¹Ÿæ˜¯æˆ‘å½“æ—¶é‡åˆ°é—®é¢˜æœ€å¤šçš„åœ°æ–¹ï¼šcontainerdé…ç½®'><title>ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤</title>

<link rel='canonical' href='https://example.com/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤'>
<meta property='og:description' content='ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤ å†™åœ¨å‰é¢ Kubernetesåœ¨æœ€æ–°çš„1.20.0ç‰ˆæœ¬ä¸­è¡¨ç¤ºæ­£å¼æ”¾å¼ƒäº†Dockerï¼ŒåŸæ¥çš„Dockeré¡¹ç›®ä¹Ÿæ—©å·²æ”¹åä¸ºMobyäº†ï¼Œå³ä¾¿Dockeråœ¨å®¹å™¨æŠ€æœ¯ä¸­ä»å æ®ä¸»æµï¼Œå¹¶ä¸”åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å¤Ÿç»§ç»­å‘å…‰å‘çƒ­ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œå®¹å™¨è¿è¡Œæ—¶å¿…ç„¶ä¹Ÿä¼šè¿›å…¥ä¸€ä¸ªå¤šæ–¹ç«äº‰çš„æ—¶ä»£ã€‚å¯¹äºé€‚é…äº†Kubernetes CRIçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Containerdå’ŒCRI-Oã€‚Dockerç›®å‰å æ®äº†çº¦ä¸ƒæˆçš„ä»½é¢ï¼Œè€Œç¬¬äºŒåContainerdä¹Ÿå æ®äº†ä¸¤æˆå¤šã€‚åˆšå¥½å®éªŒå®¤æœ‰æ­å»ºé›†ç¾¤çš„éœ€æ±‚ï¼Œä½œä¸ºçˆ±æŠ˜è…¾æ˜Ÿäººï¼Œå†³å®šç´§è·Ÿæ—¶ä»£ï¼Œç”¨æœ€æ–°çš„V1.20.0çš„Kubernetesä¸Containerdæ¥æ­å»ºæˆ‘ä»¬çš„å®éªŒé›†ç¾¤ã€‚æˆ‘ä¼šç®€å•è®²è§£æˆ‘çš„é…ç½®è¿‡ç¨‹ä»¥åŠä¸­é—´é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼Œæ¯•ç«Ÿè‡ªå·±è¸©è¿‡çš„å‘ï¼Œå¾—è®²ä¸€éæ‰èƒ½è®°å¾—æ·±åˆ»ï¼ˆç¬‘ï¼‰
æœ¬æ–‡æ‰€éœ€shellè„šæœ¬éƒ½åœ¨è¿™ä¸ªrepoï¼Œå¦‚æœä¹‹åæœ‰éœ€è¦ä¹Ÿä¼šä¸æ–­æ›´æ–°ï¼Œå¯¹äºé…ç½®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é—®é¢˜æ¬¢è¿åœ¨issueä¸­è®¨è®ºã€‚
é…ç½®åŸºæœ¬ç¯å¢ƒ è¿™æ¬¡æ‰“ç®—åœ¨å››å°è£¸æœºä¸Šéƒ¨ç½²ä¸€ä¸ªå•masterèŠ‚ç‚¹ï¼Œä¸‰ä¸ªworkerèŠ‚ç‚¹çš„å°é›†ç¾¤ï¼Œå•æœºé…ç½®å¦‚ä¸‹ï¼š
 CleanShot_2020-12-18_at_21.54.34@2x 
å½“ç„¶è¿™æ˜¯æˆ‘éƒ¨ç½²å¥½åçš„æˆªå›¾ï¼Œä¸»æœºçš„åç§°ä¹Ÿæ”¹ä¸ºäº†ip&#43;nodeTypeï¼Œæ–¹ä¾¿è¯†åˆ«å½“å‰ä¸»æœºï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å¿…é¡»ä¿®æ”¹çš„ï¼Œå› ä¸ºåŸæ¥çš„å››å°ä¸»æœºçš„ä¸»æœºåéƒ½ä¸ºlocalhost.localdomainï¼ŒåŒåä¸»æœºåœ¨å»ºç«‹é›†ç¾¤åä¸èƒ½ä¸€èµ·æ˜¾ç¤ºï¼Œè¿™ä¹Ÿæ˜¯é…ç½®æ—¶é‡åˆ°çš„å‘ä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŒæ ·å°†æ”¹åçš„å‘½ä»¤åˆ†åˆ«å†™åœ¨äº†04_pull_master_images.shä¸04_pull_worker_images.shï¼Œå¯ä»¥è‡ªåŠ¨å®ç°å°†ä¸»æœºåæ›¿æ¢ä¸ºip&#43;nodeTypeï¼Œå½“ç„¶ï¼Œè¿™éƒ½æ˜¯åè¯äº†ã€‚
æœ¬æ¬¡ä¸»è¦æ˜¯åœ¨CentOS7ä¸‹è¿›è¡Œé…ç½®ï¼Œè¦æ±‚èƒ½è¿æ¥å¤–ç½‘ï¼Œå¯¹äºkubernetséœ€è¦çš„k8s.gcr.ioä¸Šçš„é•œåƒæˆ‘ä¹Ÿå·²ç»åœ¨é˜¿é‡Œäº‘ä¸ŠåŒæ­¥äº†ä¸€ä»½ï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‚ä»£ç†çš„è¦æ±‚ã€‚å½“ç„¶æœ€å¥½è¿˜æ˜¯åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œä¸ä¿è¯érootç”¨æˆ·çš„æ‰§è¡Œæ•ˆæœï¼ˆå¯å¢åŠ sudoå°è¯•ï¼‰
å¯¹äºæ¯ä¸€å°æœºå™¨ï¼Œåªéœ€è¦ä¸€æ¬¡æ‰§è¡Œ00ï½02å¯¹åº”è„šæœ¬
# cdè¿›å…¥è„šæœ¬å¯¹åº”ç›®å½• bash 00_install_tools.sh bash 01_config_env.sh bash 02_install_kube.sh   00å®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ï¼Œå¦‚gitã€vimã€unzipã€ntpdateç­‰ï¼Œå®‰è£…äº†yum epelå¹¶å¯¹yumè¿›è¡Œäº†æ¢æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›å¸¸ç”¨çš„å·¥å…·å¦‚zshã€neofetchã€htopç­‰ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†shellåˆ‡æ¢ä¸ºzshï¼ˆâš ï¸æ³¨æ„ï¼Œåæ–‡çš„è„šæœ¬éƒ½æ˜¯åŸºäºä¿®æ”¹~/.zshrcæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨zshï¼Œè¯·å¯¹åº”ä¿®æ”¹ä¸º~/.bashrcæˆ–~./bash_profileï¼‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åšä¿®æ”¹ã€‚
  01è®¾ç½®äº†ä¸€äº›åŸºæœ¬ç¯å¢ƒé…ç½®ï¼Œå…³é—­firewalldå’Œswapï¼Œè®¾ç½®äº†iptableè½¬å‘ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶é—´è¿›è¡ŒåŒæ­¥ï¼Œå¹¶ä¿®æ”¹ä¸ºCSTæ—¶åŒºï¼Œä¿è¯å„ä¸ªä¸»æœºä¸Šæ—¶é—´çš„ä¸€è‡´æ€§å¯¹é›†ç¾¤çš„é…ç½®ä¹Ÿè‡³å…³é‡è¦ã€‚
  02ä¸ºyumæ·»åŠ äº†Kubernetesçš„repoï¼Œå®‰è£…äº†1.20.0ç‰ˆæœ¬çš„kubeletã€kubeadmã€kubectlä¸‰ä»¶å¥—
  å®‰è£…Containerd æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€å°ä¸»æœºå®‰è£…Containerdæ›¿æ¢ä¹‹å‰çš„Dockerã€‚
ä¸€é”®å®‰è£…ï¼š
bash 03_install_containerd.sh Containerdçš„å®˜æ–¹quick-startæ–‡æ¡£ä¼šé»˜è®¤ä½ å·²ç»å®‰è£…äº†runcï¼ˆContainerdé»˜è®¤çš„å®¹å™¨è¿è¡Œå·¥å…·ï¼‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬è¿˜æ˜¯è¦å®‰è£…runcï¼Œå¦åˆ™å°†æ— æ³•è¿è¡Œå®¹å™¨ã€‚
æˆ‘ä»¬ç›´æ¥é€‰æ‹©æ‹‰å–runcçš„å®˜æ–¹ä»“åº“è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œruncæ¯”è¾ƒå°ï¼Œç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯éœ€è¦æœ‰goçš„è¿è¡Œç¯å¢ƒå’Œlibseccomp ã€libseccomp-develä¸¤ä¸ªé“¾æ¥åº“ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚è¿™äº›éƒ½åœ¨è„šæœ¬ä¸­å®‰è£…å¥½äº†ï¼Œå¦‚æœä½ ä¸æƒ³ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°$PATHå¯¹åº”çš„ç›®å½•ä¸­å³å¯ã€‚
# install runc git clone https://github.com/opencontainers/runc cd runc &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install è¿™æ ·å°±å®‰è£…å¥½äº†runcå·¥å…·
å®‰è£…Containerdä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸‹è½½å®˜æ–¹ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…ï¼Œè§£å‹å¯¹åº”ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿé€‰æ‹©äº†è¾ƒæ–°çš„1.4.3ç‰ˆæœ¬ï¼Œç”šè‡³å®˜æ–¹ä»“åº“çš„release tagé‡Œè¿˜æ˜¯1.3.9ç‰ˆæœ¬
CONTAINERD_VERSION=1.4.3 wget https://github.com/containerd/containerd/releases/download/v&amp;#34;$CONTAINERD_VERSION&amp;#34;/containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz tar -xvf containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz -C /usr/local/ æ¥ä¸‹æ¥å°±æ˜¯æ¯”è¾ƒå…³é”®ä¹Ÿæ˜¯æˆ‘å½“æ—¶é‡åˆ°é—®é¢˜æœ€å¤šçš„åœ°æ–¹ï¼šcontainerdé…ç½®'>
<meta property='og:url' content='https://example.com/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/'>
<meta property='og:site_name' content='ã‹ãŒã‚„ã®éƒ¨å±‹'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Kubernetes' /><meta property='article:tag' content='Containerd' /><meta property='article:tag' content='Config' /><meta property='article:published_time' content='2020-12-17T23:31:25&#43;08:00'/><meta property='article:modified_time' content='2020-12-17T23:31:25&#43;08:00'/><meta property='og:image' content='https://example.com/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/k8s.png' />
<meta name="twitter:site" content="kagaya_85"><meta name="twitter:title" content="ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤">
<meta name="twitter:description" content="ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤ å†™åœ¨å‰é¢ Kubernetesåœ¨æœ€æ–°çš„1.20.0ç‰ˆæœ¬ä¸­è¡¨ç¤ºæ­£å¼æ”¾å¼ƒäº†Dockerï¼ŒåŸæ¥çš„Dockeré¡¹ç›®ä¹Ÿæ—©å·²æ”¹åä¸ºMobyäº†ï¼Œå³ä¾¿Dockeråœ¨å®¹å™¨æŠ€æœ¯ä¸­ä»å æ®ä¸»æµï¼Œå¹¶ä¸”åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å¤Ÿç»§ç»­å‘å…‰å‘çƒ­ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œå®¹å™¨è¿è¡Œæ—¶å¿…ç„¶ä¹Ÿä¼šè¿›å…¥ä¸€ä¸ªå¤šæ–¹ç«äº‰çš„æ—¶ä»£ã€‚å¯¹äºé€‚é…äº†Kubernetes CRIçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Containerdå’ŒCRI-Oã€‚Dockerç›®å‰å æ®äº†çº¦ä¸ƒæˆçš„ä»½é¢ï¼Œè€Œç¬¬äºŒåContainerdä¹Ÿå æ®äº†ä¸¤æˆå¤šã€‚åˆšå¥½å®éªŒå®¤æœ‰æ­å»ºé›†ç¾¤çš„éœ€æ±‚ï¼Œä½œä¸ºçˆ±æŠ˜è…¾æ˜Ÿäººï¼Œå†³å®šç´§è·Ÿæ—¶ä»£ï¼Œç”¨æœ€æ–°çš„V1.20.0çš„Kubernetesä¸Containerdæ¥æ­å»ºæˆ‘ä»¬çš„å®éªŒé›†ç¾¤ã€‚æˆ‘ä¼šç®€å•è®²è§£æˆ‘çš„é…ç½®è¿‡ç¨‹ä»¥åŠä¸­é—´é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼Œæ¯•ç«Ÿè‡ªå·±è¸©è¿‡çš„å‘ï¼Œå¾—è®²ä¸€éæ‰èƒ½è®°å¾—æ·±åˆ»ï¼ˆç¬‘ï¼‰
æœ¬æ–‡æ‰€éœ€shellè„šæœ¬éƒ½åœ¨è¿™ä¸ªrepoï¼Œå¦‚æœä¹‹åæœ‰éœ€è¦ä¹Ÿä¼šä¸æ–­æ›´æ–°ï¼Œå¯¹äºé…ç½®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é—®é¢˜æ¬¢è¿åœ¨issueä¸­è®¨è®ºã€‚
é…ç½®åŸºæœ¬ç¯å¢ƒ è¿™æ¬¡æ‰“ç®—åœ¨å››å°è£¸æœºä¸Šéƒ¨ç½²ä¸€ä¸ªå•masterèŠ‚ç‚¹ï¼Œä¸‰ä¸ªworkerèŠ‚ç‚¹çš„å°é›†ç¾¤ï¼Œå•æœºé…ç½®å¦‚ä¸‹ï¼š
 CleanShot_2020-12-18_at_21.54.34@2x 
å½“ç„¶è¿™æ˜¯æˆ‘éƒ¨ç½²å¥½åçš„æˆªå›¾ï¼Œä¸»æœºçš„åç§°ä¹Ÿæ”¹ä¸ºäº†ip&#43;nodeTypeï¼Œæ–¹ä¾¿è¯†åˆ«å½“å‰ä¸»æœºï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å¿…é¡»ä¿®æ”¹çš„ï¼Œå› ä¸ºåŸæ¥çš„å››å°ä¸»æœºçš„ä¸»æœºåéƒ½ä¸ºlocalhost.localdomainï¼ŒåŒåä¸»æœºåœ¨å»ºç«‹é›†ç¾¤åä¸èƒ½ä¸€èµ·æ˜¾ç¤ºï¼Œè¿™ä¹Ÿæ˜¯é…ç½®æ—¶é‡åˆ°çš„å‘ä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŒæ ·å°†æ”¹åçš„å‘½ä»¤åˆ†åˆ«å†™åœ¨äº†04_pull_master_images.shä¸04_pull_worker_images.shï¼Œå¯ä»¥è‡ªåŠ¨å®ç°å°†ä¸»æœºåæ›¿æ¢ä¸ºip&#43;nodeTypeï¼Œå½“ç„¶ï¼Œè¿™éƒ½æ˜¯åè¯äº†ã€‚
æœ¬æ¬¡ä¸»è¦æ˜¯åœ¨CentOS7ä¸‹è¿›è¡Œé…ç½®ï¼Œè¦æ±‚èƒ½è¿æ¥å¤–ç½‘ï¼Œå¯¹äºkubernetséœ€è¦çš„k8s.gcr.ioä¸Šçš„é•œåƒæˆ‘ä¹Ÿå·²ç»åœ¨é˜¿é‡Œäº‘ä¸ŠåŒæ­¥äº†ä¸€ä»½ï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‚ä»£ç†çš„è¦æ±‚ã€‚å½“ç„¶æœ€å¥½è¿˜æ˜¯åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œä¸ä¿è¯érootç”¨æˆ·çš„æ‰§è¡Œæ•ˆæœï¼ˆå¯å¢åŠ sudoå°è¯•ï¼‰
å¯¹äºæ¯ä¸€å°æœºå™¨ï¼Œåªéœ€è¦ä¸€æ¬¡æ‰§è¡Œ00ï½02å¯¹åº”è„šæœ¬
# cdè¿›å…¥è„šæœ¬å¯¹åº”ç›®å½• bash 00_install_tools.sh bash 01_config_env.sh bash 02_install_kube.sh   00å®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ï¼Œå¦‚gitã€vimã€unzipã€ntpdateç­‰ï¼Œå®‰è£…äº†yum epelå¹¶å¯¹yumè¿›è¡Œäº†æ¢æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›å¸¸ç”¨çš„å·¥å…·å¦‚zshã€neofetchã€htopç­‰ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†shellåˆ‡æ¢ä¸ºzshï¼ˆâš ï¸æ³¨æ„ï¼Œåæ–‡çš„è„šæœ¬éƒ½æ˜¯åŸºäºä¿®æ”¹~/.zshrcæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨zshï¼Œè¯·å¯¹åº”ä¿®æ”¹ä¸º~/.bashrcæˆ–~./bash_profileï¼‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åšä¿®æ”¹ã€‚
  01è®¾ç½®äº†ä¸€äº›åŸºæœ¬ç¯å¢ƒé…ç½®ï¼Œå…³é—­firewalldå’Œswapï¼Œè®¾ç½®äº†iptableè½¬å‘ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶é—´è¿›è¡ŒåŒæ­¥ï¼Œå¹¶ä¿®æ”¹ä¸ºCSTæ—¶åŒºï¼Œä¿è¯å„ä¸ªä¸»æœºä¸Šæ—¶é—´çš„ä¸€è‡´æ€§å¯¹é›†ç¾¤çš„é…ç½®ä¹Ÿè‡³å…³é‡è¦ã€‚
  02ä¸ºyumæ·»åŠ äº†Kubernetesçš„repoï¼Œå®‰è£…äº†1.20.0ç‰ˆæœ¬çš„kubeletã€kubeadmã€kubectlä¸‰ä»¶å¥—
  å®‰è£…Containerd æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€å°ä¸»æœºå®‰è£…Containerdæ›¿æ¢ä¹‹å‰çš„Dockerã€‚
ä¸€é”®å®‰è£…ï¼š
bash 03_install_containerd.sh Containerdçš„å®˜æ–¹quick-startæ–‡æ¡£ä¼šé»˜è®¤ä½ å·²ç»å®‰è£…äº†runcï¼ˆContainerdé»˜è®¤çš„å®¹å™¨è¿è¡Œå·¥å…·ï¼‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬è¿˜æ˜¯è¦å®‰è£…runcï¼Œå¦åˆ™å°†æ— æ³•è¿è¡Œå®¹å™¨ã€‚
æˆ‘ä»¬ç›´æ¥é€‰æ‹©æ‹‰å–runcçš„å®˜æ–¹ä»“åº“è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œruncæ¯”è¾ƒå°ï¼Œç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯éœ€è¦æœ‰goçš„è¿è¡Œç¯å¢ƒå’Œlibseccomp ã€libseccomp-develä¸¤ä¸ªé“¾æ¥åº“ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚è¿™äº›éƒ½åœ¨è„šæœ¬ä¸­å®‰è£…å¥½äº†ï¼Œå¦‚æœä½ ä¸æƒ³ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°$PATHå¯¹åº”çš„ç›®å½•ä¸­å³å¯ã€‚
# install runc git clone https://github.com/opencontainers/runc cd runc &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install è¿™æ ·å°±å®‰è£…å¥½äº†runcå·¥å…·
å®‰è£…Containerdä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸‹è½½å®˜æ–¹ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…ï¼Œè§£å‹å¯¹åº”ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿé€‰æ‹©äº†è¾ƒæ–°çš„1.4.3ç‰ˆæœ¬ï¼Œç”šè‡³å®˜æ–¹ä»“åº“çš„release tagé‡Œè¿˜æ˜¯1.3.9ç‰ˆæœ¬
CONTAINERD_VERSION=1.4.3 wget https://github.com/containerd/containerd/releases/download/v&amp;#34;$CONTAINERD_VERSION&amp;#34;/containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz tar -xvf containerd-&amp;#34;$CONTAINERD_VERSION&amp;#34;-linux-amd64.tar.gz -C /usr/local/ æ¥ä¸‹æ¥å°±æ˜¯æ¯”è¾ƒå…³é”®ä¹Ÿæ˜¯æˆ‘å½“æ—¶é‡åˆ°é—®é¢˜æœ€å¤šçš„åœ°æ–¹ï¼šcontainerdé…ç½®"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://example.com/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/k8s.png' />
    </head>
    <body class="">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu84db507eb8e14f8e7f807ecb710408fc_380431_300x0_resize_box_2.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">ğŸš€</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://example.com">ã‹ãŒã‚„ã®éƒ¨å±‹</a></h1>
        <h2 class="site-description">æ˜æ—¥ã¯æ™´ã‚Œã‚‹ã‹ãªã€œ</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="44" height="44"
  viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>
                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="44" height="44"
    viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <circle cx="12" cy="7" r="4" />
    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>
                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='https://twitter.com/kagaya_85'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="44" height="44"
    viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path
        d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>
                
                <span>Twitter</span>
            </a>
        </li>
        
        

        <li >
            <a href='https://bangumi.tv/user/kagaya85'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="44" height="44"
    viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <rect x="3" y="7" width="18" height="13" rx="2" />
    <polyline points="16 3 12 7 8 3" />
</svg>
                
                <span>Bangumi</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="44" height="44"
    viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <circle cx="10" cy="10" r="7" />
    <line x1="21" y1="21" x2="15" y2="15" />
</svg>
                
                <span>Search</span>
            </a>
        </li>
        

        
    </ol>
</aside>

            <main class="main full-width">
    <div id="article-toolbar">
        <a href="https://example.com" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



            <span>Back</span>
        </a>
    </div>

    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/">
                <img src="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/k8s_huc297a0f1028b89bda40fcadefea13798_151152_800x0_resize_box_2.png"
                        srcset="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/k8s_huc297a0f1028b89bda40fcadefea13798_151152_800x0_resize_box_2.png 800w, /p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/k8s_huc297a0f1028b89bda40fcadefea13798_151152_1600x0_resize_box_2.png 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/technology/" style="background-color: #66ccff; color: #fff;">
                Technology
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/">ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤</a>
    </h2>

    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Dec 17, 2020</time>
    </footer></div>
</header>

    <section class="article-content">
    <h1 id="ä½¿ç”¨kubernetes-v1200-ä¸-containerd-é…ç½®k8sé›†ç¾¤">ä½¿ç”¨Kubernetes V1.20.0 ä¸ Containerd é…ç½®K8sé›†ç¾¤</h1>
<h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2>
<p>Kubernetesåœ¨æœ€æ–°çš„1.20.0ç‰ˆæœ¬ä¸­è¡¨ç¤ºæ­£å¼æ”¾å¼ƒäº†Dockerï¼ŒåŸæ¥çš„Dockeré¡¹ç›®ä¹Ÿæ—©å·²æ”¹åä¸ºMobyäº†ï¼Œå³ä¾¿Dockeråœ¨å®¹å™¨æŠ€æœ¯ä¸­ä»å æ®ä¸»æµï¼Œå¹¶ä¸”åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å¤Ÿç»§ç»­å‘å…‰å‘çƒ­ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œå®¹å™¨è¿è¡Œæ—¶å¿…ç„¶ä¹Ÿä¼šè¿›å…¥ä¸€ä¸ªå¤šæ–¹ç«äº‰çš„æ—¶ä»£ã€‚å¯¹äºé€‚é…äº†Kubernetes CRIçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Containerdå’ŒCRI-Oã€‚Dockerç›®å‰å æ®äº†çº¦ä¸ƒæˆçš„ä»½é¢ï¼Œè€Œç¬¬äºŒåContainerdä¹Ÿå æ®äº†ä¸¤æˆå¤šã€‚åˆšå¥½å®éªŒå®¤æœ‰æ­å»ºé›†ç¾¤çš„éœ€æ±‚ï¼Œä½œä¸ºçˆ±æŠ˜è…¾æ˜Ÿäººï¼Œå†³å®šç´§è·Ÿæ—¶ä»£ï¼Œç”¨æœ€æ–°çš„V1.20.0çš„Kubernetesä¸Containerdæ¥æ­å»ºæˆ‘ä»¬çš„å®éªŒé›†ç¾¤ã€‚æˆ‘ä¼šç®€å•è®²è§£æˆ‘çš„é…ç½®è¿‡ç¨‹ä»¥åŠä¸­é—´é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼Œæ¯•ç«Ÿè‡ªå·±è¸©è¿‡çš„å‘ï¼Œå¾—è®²ä¸€éæ‰èƒ½è®°å¾—æ·±åˆ»ï¼ˆç¬‘ï¼‰</p>
<p>æœ¬æ–‡æ‰€éœ€shellè„šæœ¬éƒ½åœ¨è¿™ä¸ª<a class="link" href="https://github.com/kagaya85/K8sTakeOff"  target="_blank" rel="noopener"
    >repo</a>ï¼Œå¦‚æœä¹‹åæœ‰éœ€è¦ä¹Ÿä¼šä¸æ–­æ›´æ–°ï¼Œå¯¹äºé…ç½®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é—®é¢˜æ¬¢è¿åœ¨issueä¸­è®¨è®ºã€‚</p>
<h2 id="é…ç½®åŸºæœ¬ç¯å¢ƒ">é…ç½®åŸºæœ¬ç¯å¢ƒ</h2>
<p>è¿™æ¬¡æ‰“ç®—åœ¨å››å°è£¸æœºä¸Šéƒ¨ç½²ä¸€ä¸ªå•masterèŠ‚ç‚¹ï¼Œä¸‰ä¸ªworkerèŠ‚ç‚¹çš„å°é›†ç¾¤ï¼Œå•æœºé…ç½®å¦‚ä¸‹ï¼š</p>
<p><figure style="flex-grow: 210; flex-basis: 504px">
		<a href="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-18_at_21.54.34@2x.png" data-size="1658x788"><img src="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-18_at_21.54.34@2x.png"
				srcset="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-18_at_21.54.34@2x_hub2912f4eb02722aaba615695faa6f67b_443680_480x0_resize_box_2.png 480w, /p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-18_at_21.54.34@2x_hub2912f4eb02722aaba615695faa6f67b_443680_1024x0_resize_box_2.png 1024w"
				width="1658"
				height="788"
				loading="lazy"
				alt="CleanShot_2020-12-18_at_21.54.34@2x">
		</a>
		
		<figcaption>CleanShot_2020-12-18_at_21.54.34@2x</figcaption>
		
	</figure></p>
<p>å½“ç„¶è¿™æ˜¯æˆ‘éƒ¨ç½²å¥½åçš„æˆªå›¾ï¼Œä¸»æœºçš„åç§°ä¹Ÿæ”¹ä¸ºäº†ip+nodeTypeï¼Œæ–¹ä¾¿è¯†åˆ«å½“å‰ä¸»æœºï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å¿…é¡»ä¿®æ”¹çš„ï¼Œå› ä¸ºåŸæ¥çš„å››å°ä¸»æœºçš„ä¸»æœºåéƒ½ä¸ºlocalhost.localdomainï¼ŒåŒåä¸»æœºåœ¨å»ºç«‹é›†ç¾¤åä¸èƒ½ä¸€èµ·æ˜¾ç¤ºï¼Œè¿™ä¹Ÿæ˜¯é…ç½®æ—¶é‡åˆ°çš„å‘ä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŒæ ·å°†æ”¹åçš„å‘½ä»¤åˆ†åˆ«å†™åœ¨äº†<code>04_pull_master_images.sh</code>ä¸<code>04_pull_worker_images.sh</code>ï¼Œå¯ä»¥è‡ªåŠ¨å®ç°å°†ä¸»æœºåæ›¿æ¢ä¸ºip+nodeTypeï¼Œå½“ç„¶ï¼Œè¿™éƒ½æ˜¯åè¯äº†ã€‚</p>
<p>æœ¬æ¬¡ä¸»è¦æ˜¯åœ¨CentOS7ä¸‹è¿›è¡Œé…ç½®ï¼Œè¦æ±‚èƒ½è¿æ¥å¤–ç½‘ï¼Œå¯¹äºkubernetséœ€è¦çš„k8s.gcr.ioä¸Šçš„é•œåƒæˆ‘ä¹Ÿå·²ç»åœ¨é˜¿é‡Œäº‘ä¸ŠåŒæ­¥äº†ä¸€ä»½ï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‚ä»£ç†çš„è¦æ±‚ã€‚å½“ç„¶æœ€å¥½è¿˜æ˜¯åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œä¸ä¿è¯érootç”¨æˆ·çš„æ‰§è¡Œæ•ˆæœï¼ˆå¯å¢åŠ sudoå°è¯•ï¼‰</p>
<p>å¯¹äºæ¯ä¸€å°æœºå™¨ï¼Œåªéœ€è¦ä¸€æ¬¡æ‰§è¡Œ00ï½02å¯¹åº”è„šæœ¬</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># cdè¿›å…¥è„šæœ¬å¯¹åº”ç›®å½•</span>
bash 00_install_tools.sh
bash 01_config_env.sh
bash 02_install_kube.sh
</code></pre></div><ul>
<li>
<p>00å®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ï¼Œå¦‚gitã€vimã€unzipã€ntpdateç­‰ï¼Œå®‰è£…äº†yum epelå¹¶å¯¹yumè¿›è¡Œäº†æ¢æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›å¸¸ç”¨çš„å·¥å…·å¦‚zshã€neofetchã€htopç­‰ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†shellåˆ‡æ¢ä¸ºzshï¼ˆâš ï¸æ³¨æ„ï¼Œåæ–‡çš„è„šæœ¬éƒ½æ˜¯åŸºäºä¿®æ”¹<code>~/.zshrc</code>æ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨zshï¼Œè¯·å¯¹åº”ä¿®æ”¹ä¸º<code>~/.bashrc</code>æˆ–<code>~./bash_profile</code>ï¼‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åšä¿®æ”¹ã€‚</p>
</li>
<li>
<p>01è®¾ç½®äº†ä¸€äº›åŸºæœ¬ç¯å¢ƒé…ç½®ï¼Œå…³é—­firewalldå’Œswapï¼Œè®¾ç½®äº†iptableè½¬å‘ç­‰ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶é—´è¿›è¡ŒåŒæ­¥ï¼Œå¹¶ä¿®æ”¹ä¸ºCSTæ—¶åŒºï¼Œä¿è¯å„ä¸ªä¸»æœºä¸Šæ—¶é—´çš„ä¸€è‡´æ€§å¯¹é›†ç¾¤çš„é…ç½®ä¹Ÿè‡³å…³é‡è¦ã€‚</p>
</li>
<li>
<p>02ä¸ºyumæ·»åŠ äº†Kubernetesçš„repoï¼Œå®‰è£…äº†1.20.0ç‰ˆæœ¬çš„kubeletã€kubeadmã€kubectlä¸‰ä»¶å¥—</p>
</li>
</ul>
<h2 id="å®‰è£…containerd">å®‰è£…Containerd</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€å°ä¸»æœºå®‰è£…Containerdæ›¿æ¢ä¹‹å‰çš„Dockerã€‚</p>
<p>ä¸€é”®å®‰è£…ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 03_install_containerd.sh
</code></pre></div><p>Containerdçš„å®˜æ–¹quick-startæ–‡æ¡£ä¼šé»˜è®¤ä½ å·²ç»å®‰è£…äº†runcï¼ˆContainerdé»˜è®¤çš„å®¹å™¨è¿è¡Œå·¥å…·ï¼‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬è¿˜æ˜¯è¦å®‰è£…runcï¼Œå¦åˆ™å°†æ— æ³•è¿è¡Œå®¹å™¨ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥é€‰æ‹©æ‹‰å–runcçš„å®˜æ–¹ä»“åº“è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œruncæ¯”è¾ƒå°ï¼Œç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯éœ€è¦æœ‰goçš„è¿è¡Œç¯å¢ƒå’Œ<code>libseccomp</code> ã€<code>libseccomp-devel</code>ä¸¤ä¸ªé“¾æ¥åº“ï¼Œå¯ä»¥å‚è€ƒ<a class="link" href="https://github.com/containerd/containerd/blob/master/BUILDING.md#build-runc"  target="_blank" rel="noopener"
    >è¿™é‡Œ</a>ã€‚è¿™äº›éƒ½åœ¨è„šæœ¬ä¸­å®‰è£…å¥½äº†ï¼Œå¦‚æœä½ ä¸æƒ³ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°<code>$PATH</code>å¯¹åº”çš„ç›®å½•ä¸­å³å¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># install runc</span>
git clone https://github.com/opencontainers/runc
<span class="nb">cd</span> runc <span class="o">&amp;&amp;</span>
  make <span class="o">&amp;&amp;</span>
  make install
</code></pre></div><p>è¿™æ ·å°±å®‰è£…å¥½äº†runcå·¥å…·</p>
<p>å®‰è£…Containerdä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸‹è½½å®˜æ–¹ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…ï¼Œè§£å‹å¯¹åº”ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿé€‰æ‹©äº†è¾ƒæ–°çš„1.4.3ç‰ˆæœ¬ï¼Œç”šè‡³å®˜æ–¹ä»“åº“çš„release tagé‡Œè¿˜æ˜¯1.3.9ç‰ˆæœ¬</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">CONTAINERD_VERSION</span><span class="o">=</span>1.4.3
wget https://github.com/containerd/containerd/releases/download/v<span class="s2">&#34;</span><span class="nv">$CONTAINERD_VERSION</span><span class="s2">&#34;</span>/containerd-<span class="s2">&#34;</span><span class="nv">$CONTAINERD_VERSION</span><span class="s2">&#34;</span>-linux-amd64.tar.gz
tar -xvf containerd-<span class="s2">&#34;</span><span class="nv">$CONTAINERD_VERSION</span><span class="s2">&#34;</span>-linux-amd64.tar.gz -C /usr/local/
</code></pre></div><p>æ¥ä¸‹æ¥å°±æ˜¯æ¯”è¾ƒå…³é”®ä¹Ÿæ˜¯æˆ‘å½“æ—¶é‡åˆ°é—®é¢˜æœ€å¤šçš„åœ°æ–¹ï¼šcontainerdé…ç½®</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œcontainerdæä¾›äº†ç”Ÿæˆé»˜è®¤é…ç½®çš„æ–¹æ³•</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># éœ€æå‰åˆ›å»ºå¯¹åº”ç›®å½• </span>
<span class="c1"># sudo mkdir -p /etc/containerd/</span>
containerd config default &gt;/etc/containerd/config.toml
</code></pre></div><p>ä½†æ˜¯è¿™æ ·ä¼šæœ‰<strong>ä¸€äº›é—®é¢˜</strong>ï¼š</p>
<ul>
<li>
<p>ä¹‹ååœ¨ä½¿ç”¨crictlå·¥å…·è¿æ¥containerdå·¥å…·æ—¶ä¼šæŠ¥é”™ï¼š</p>
<pre><code>unknown service runtime.v1alpha2.ImageService &amp;Unimplemented desc = unknown service api.v1.CRIPluginService
</code></pre><p>å¯å‚è€ƒè¿™ä¸ª<a class="link" href="https://github.com/kubernetes-sigs/cri-tools/issues/436#issuecomment-464290289"  target="_blank" rel="noopener"
    >issue</a>ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ³•å°±æ˜¯ä¿®æ”¹ä»¥ä¸‹é…ç½®</p>
<div class="highlight"><pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">]</span>
	<span class="nx">snapshotter</span> <span class="p">=</span> <span class="s2">&#34;overlayfs&#34;</span> <span class="err">--&gt;</span> <span class="s2">&#34;native&#34;</span>
	<span class="nx">default_runtime_name</span> <span class="p">=</span> <span class="s2">&#34;runc&#34;</span>
	<span class="nx">no_pivot</span> <span class="p">=</span> <span class="kc">false</span>
</code></pre></div></li>
<li>
<p>åé¢åœ¨ä½¿ç”¨<code>kubeadm init</code>åˆå§‹åŒ–é›†ç¾¤æ—¶ï¼Œåœ¨å¯åŠ¨apiserverç­‰podæ—¶ï¼Œä¼šæŠ¥é”™ï¼š</p>
<pre><code>        Unfortunately, an error has occurred:
                timed out waiting for the condition
  
        This error is likely caused by:
                - The kubelet is not running
                - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)
  
        If you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:
                - 'systemctl status kubelet'
                - 'journalctl -xeu kubelet'
  
        Additionally, a control plane component may have crashed or exited when started by the container runtime.
        To troubleshoot, list all containers using your preferred container runtimes CLI.
  
        Here is one example how you may list all Kubernetes containers running in cri-o/containerd using crictl:
                - 'crictl --runtime-endpoint /run/containerd/containerd.sock ps -a | grep kube | grep -v pause'
                Once you have found the failing container, you can inspect its logs with:
                - 'crictl --runtime-endpoint /run/containerd/containerd.sock logs CONTAINERID'
  
couldn't initialize a Kubernetes cluster
</code></pre><p>ä½¿ç”¨<code>systemctl status kubelet</code>æŸ¥çœ‹kubeletæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°kubeletæœ‰åœ¨è¿è¡Œä½†æ˜¯æ—¥å¿—é‡Œä¸€ç›´æ‰“å°<code>node &quot;localhost.localdomain&quot; not found</code></p>
<pre><code>â— kubelet.service - kubelet: The Kubernetes Node Agent
   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)
  Drop-In: /usr/lib/systemd/system/kubelet.service.d
           â””â”€10-kubeadm.conf
   Active: active (running) since Thu 2020-12-17 20:48:18 CST; 6min ago
     Docs: https://kubernetes.io/docs/
 Main PID: 10688 (kubelet)
    Tasks: 18
   Memory: 37.6M
   CGroup: /system.slice/kubelet.service
           â””â”€10688 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf ...
  
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.161585   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.261944   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.362297   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.462629   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.562916   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.663161   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.763546   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.863925   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:35 localhost.localdomain kubelet[10688]: E1217 07:54:35.964162   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
Dec 17 20:54:36 localhost.localdomain kubelet[10688]: E1217 07:54:36.064368   10688 kubelet.go:2240] node &quot;localhost.localdomain&quot; not found
</code></pre><p>è¿™é‡Œçš„æ—¥å¿—ä¸å¤Ÿè¯¦ç»†ï¼Œäºæ˜¯æˆ‘åˆä½¿ç”¨<code>journalctl -xeu kubelet</code>æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Œæ—¥å¿—æ•°é‡æ¯”è¾ƒå¤šï¼Œå¾ˆå®¹æ˜“æ¼æ‰å…³é”®çš„é”™è¯¯ï¼Œæ¯”å¦‚è¯´ä¸‹é¢è¿™æ¡æŠ¥é”™æ˜¯æˆ‘åœ¨é‡è¯•äº†å¤šæ¬¡åæ‰åœ¨æ—¥å¿—ä¸­å‘ç°çš„ï¼š</p>
<pre><code>CreatePodSandbox for pod &quot;kube-scheduler-localhost.localdomain_kube-system(a28385ea64639c19ce25476016scheduler-localhost.localdomain_kube-system(a28385ea64639c19ce254760161b1d3b)&quot; failed: rpc error: code = Unknown desc = failed to get sandboxb1d3b)&quot; failed: rpc error: code = Unknown desc = failed to get sandbox image &quot;k8s.gcr.io/pause:3.1&quot;: failed to pull image &quot;k8s.gcr.io/pause:3.1&quot;: failed to pull image &quot;k8s.gcr.io/pause:3.1&quot;: failed to pull and unpack image &quot;k8s.gcr.io/pause:3.1&quot;:
</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸­çš„å…³é”®ä¿¡æ¯<code>failed to pull image &quot;k8s.gcr.io/pause:3.1&quot;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´kubeletåˆ›å»ºpodæ—¶å¡åœ¨äº†æ‹‰å–pauseé•œåƒè¿™ä¸€æ­¥ï¼Œå½“æ—¶åœ¨åˆå§‹åŒ–kubeadmä¹‹å‰ï¼Œæˆ‘å·²ç»åœ¨æœ¬åœ°å‡†å¤‡å¥½äº†æ‰€æœ‰æ‰€éœ€è¦çš„é•œåƒï¼Œå¹¶ä¸”kubeadmé€šè¿‡æŒ‡å®šé•œåƒä»“åº“çš„å‚æ•°<code>--image-repository=${IMAGE_REPOSITORY}</code>å·²ç»å°†kubeletæ‰€è¦æ‹‰å–é•œåƒçš„ç›®æ ‡ä»“åº“åˆ‡æ¢ä¸ºé˜¿é‡Œäº‘çš„ä»“åº“ï¼Œä½†è¿™é‡Œè¿˜æ˜¯å»ä»ä¸€ä¸ªä¸å­˜åœ¨çš„è°·æ­Œå®¹å™¨ä»“åº“k8s.gcr.ioæ‹‰å–é•œåƒï¼Œå¯¼è‡´æˆ‘åœ¨è¿™é‡Œä¸€åº¦æ€€ç–‘æ˜¯kubeletçš„é…ç½®é—®é¢˜ã€‚</p>
<p>ç›´åˆ°æˆ‘ç¿»åˆ°äº†kubeadmçš„<a class="link" href="https://github.com/kubernetes/kubeadm/issues/2020"  target="_blank" rel="noopener"
    >issue#2020</a>ä¸­æåˆ°äº†kubeadmå¹¶ä¸ä¼šé…ç½®pause imageçš„repositoryï¼Œä»¥åŠåœ¨containerdçš„<a class="link" href="https://github.com/containerd/cri/issues/813"  target="_blank" rel="noopener"
    >issue#813</a>ï¼Œæåˆ°äº†<strong>pauseé•œåƒçš„ä»“åº“åŠç‰ˆæœ¬æ˜¯å†™åœ¨containerdçš„é…ç½®æ–‡ä»¶ä¸­</strong>ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦åœ¨<code>config.toml</code>ä¸­ä¿®æ”¹ä»¥ä¸‹é…ç½®</p>
<div class="highlight"><pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">]</span>
  <span class="nx">disable_tcp_service</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">stream_server_address</span> <span class="p">=</span> <span class="s2">&#34;127.0.0.1&#34;</span>
  <span class="nx">stream_server_port</span> <span class="p">=</span> <span class="s2">&#34;0&#34;</span>
  <span class="nx">stream_idle_timeout</span> <span class="p">=</span> <span class="s2">&#34;4h0m0s&#34;</span>
  <span class="nx">enable_selinux</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="nx">sandbox_image</span> <span class="p">=</span> <span class="s2">&#34;k8s.gcr.io/pause:3.1&#34;</span> <span class="err">--&gt;</span> <span class="s2">&#34;registry.cn-hangzhou.aliyuncs.com/kagaya/pause:3.2&#34;</span>
</code></pre></div><p>ä»¥ä¸Šé—®é¢˜å°±è§£å†³äº†:-(</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œé…ç½®è„šæœ¬ä¸­ç›´æ¥ç”Ÿæˆäº†ä¿®æ”¹å¥½çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨è„šæœ¬å°±ä¸ä¼šé‡åˆ°ä»¥ä¸Šé—®é¢˜äº†</p>
<h2 id="å®‰è£…kuberneteså¹¶åˆ›å»ºé›†ç¾¤">å®‰è£…Kuberneteså¹¶åˆ›å»ºé›†ç¾¤</h2>
<p>ä»¥ä¸Šçš„æ“ä½œæ˜¯éœ€è¦åœ¨æ¯ä¸€å°ä¸»æœºè¿›è¡Œé…ç½®ï¼Œæ¥ä¸‹æ¥çš„æ“ä½œå¯èƒ½ä¼šæœ‰Masterä¸Workerä¸»æœºçš„åŒºåˆ«ï¼Œè¯·æ³¨æ„ã€‚</p>
<p>è¿™é‡Œå…ˆä½¿ç”¨ä¸Šä¸€æ­¥é…ç½®å¥½çš„crictlå·¥å…·æ‹‰å–é•œåƒä¸ºåˆ›å»ºé›†ç¾¤æ—¶èŠ‚çœæ—¶é—´</p>
<ul>
<li>
<p>å‡†å¤‡MasterèŠ‚ç‚¹é•œåƒ</p>
<p>æ‰§è¡Œä»¥ä¸‹è„šæœ¬</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 04_pull_master_images.sh
</code></pre></div></li>
<li>
<p>å‡†å¤‡WorkerèŠ‚ç‚¹é•œåƒ</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 04_pull_worker_images.sh
</code></pre></div></li>
<li>
<p>ä»¥ä¸Šä¸¤æ­¥ä¼šä»¥ip+nodeTypeçš„æ ¼å¼åŒæ—¶ä¿®æ”¹Masterå’ŒWorkerèŠ‚ç‚¹çš„ä¸»æœºåï¼ŒåŸå› å†™åœ¨äº†æ–‡ç« å¼€å¤´</p>
</li>
<li>
<p>åˆå§‹åŒ–MasterèŠ‚ç‚¹</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 05_init_master.sh
</code></pre></div><p>è¿™ä¸€æ­¥ä¼šåœ¨kubeadmä¸­æŒ‡å®škubernetesçš„ç‰ˆæœ¬ï¼ŒCIDRèŒƒå›´ï¼Œé•œåƒä»“åº“ç­‰ï¼Œå¦‚æœé¡ºåˆ©çš„è¯ï¼Œä½ å¯ä»¥çœ‹åˆ°æœ€åæ‰“å°çš„å…¶ä»–èŠ‚ç‚¹joiné›†ç¾¤çš„æ–¹æ³•ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<pre><code>kubeadm join 192.168.0.170:6443 --token r7w69v.3e1nweyk81h5zj6y \
    --discovery-token-ca-cert-hash sha256:1234a2317d27f0a4c6bcf5f284416a2fb3e8f3bd61aa88bc279a4f6ef18e09a1 
</code></pre><p>ä¹‹åéœ€è¦æ‰‹åŠ¨åœ¨<strong>å„ä¸ªWorkerèŠ‚ç‚¹</strong>ä¸Šæ‰§è¡Œä¸€ä¸‹è¿™æ¡å‘½ä»¤åŠ å…¥Masteræ‰€åœ¨é›†ç¾¤ï¼Œè¯·åŠ¡å¿…ç¡®ä¿å„èŠ‚ç‚¹æ—¶é—´åŒæ­¥ï¼Œå› ä¸ºtokençš„åˆæ³•æ€§ä¼šç”¨æ—¶é—´å»éªŒè¯ã€‚</p>
</li>
<li>
<p>å¦‚æœéœ€è¦ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨<code>05_init_worker_kubectl.sh</code>æ¥åˆå§‹åŒ–WorkerèŠ‚ç‚¹ä¸Šçš„kubectlå‘½ä»¤</p>
</li>
</ul>
<p>å¦‚æœä»¥ä¸Šæ­¥éª¤é¡ºåˆ©çš„è¯ï¼Œä½ ç°åœ¨å¯ä»¥åœ¨MasterèŠ‚ç‚¹ä¸Šä½¿ç”¨<code>kubectl get nodes -o wide</code>çœ‹åˆ°å„ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå½“ç„¶Statusä¸ºNotReadyæ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ‰§è¡Œæœ€åä¸€æ­¥ï¼Œå®‰è£…calicoç½‘ç»œ</p>
<p><figure style="flex-grow: 585; flex-basis: 1404px">
		<a href="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-17_at_22.41.02@2x.png" data-size="2844x486"><img src="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-17_at_22.41.02@2x.png"
				srcset="/p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-17_at_22.41.02@2x_huc97783dc9143c0c3afb15a5fd895f228_397182_480x0_resize_box_2.png 480w, /p/2020/%E4%BD%BF%E7%94%A8kubernetes-v1.20.0-%E4%B8%8E-containerd-%E9%85%8D%E7%BD%AEk8s%E9%9B%86%E7%BE%A4/CleanShot_2020-12-17_at_22.41.02@2x_huc97783dc9143c0c3afb15a5fd895f228_397182_1024x0_resize_box_2.png 1024w"
				width="2844"
				height="486"
				loading="lazy"
				alt="CleanShot_2020-12-17_at_22.41.02@2x">
		</a>
		
		<figcaption>CleanShot_2020-12-17_at_22.41.02@2x</figcaption>
		
	</figure></p>
<h2 id="å®‰è£…calicoç½‘ç»œ">å®‰è£…Calicoç½‘ç»œ</h2>
<p>è¿™ä¸€æ­¥å°±æ¯”è¾ƒç®€å•äº†ï¼Œåªéœ€è¦åœ¨æ¯ä¸ªNodeä¸Šéƒ½ä»Dockerhubä¸Šæ‹‰å–å¯¹åº”çš„é•œåƒï¼Œç„¶åä»<strong>MasterèŠ‚ç‚¹</strong>ä¸Šç”¨kubectlåº”ç”¨yamlæ–‡ä»¶ã€‚</p>
<p>ä¸€é”®è„šæœ¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 06_install_calico.sh
</code></pre></div><p>è¿™é‡Œä¹Ÿé€‰ç”¨äº†è¾ƒæ–°çš„Calico v3.17.1</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">CALICO_VERSION</span><span class="o">=</span>v3.17.1

crictl pull calico/cni:<span class="nv">$CALICO_VERSION</span>
crictl pull calico/pod2daemon-flexvol:<span class="nv">$CALICO_VERSION</span>
crictl pull calico/node:<span class="nv">$CALICO_VERSION</span>
crictl pull calico/kube-controllers:<span class="nv">$CALICO_VERSION</span>
</code></pre></div><p>é»˜è®¤çš„yamlæ–‡ä»¶æ¥è‡ªå®˜æ–¹çš„3.17ç‰ˆæœ¬ï¼Œæˆ‘ä¹Ÿåœ¨manifestsç›®å½•ä¸‹å‡†å¤‡äº†ç¦»çº¿ç‰ˆæœ¬</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">CALICO_YAML</span><span class="o">=</span><span class="s2">&#34;https://docs.projectcalico.org/v3.17/manifests/calico.yaml&#34;</span>
<span class="c1"># CALICO_YAML=&#34;./manifests/calico.yaml&#34;</span>
</code></pre></div><p>kubernetesä¼šåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šä½¿ç”¨DaemonSetçš„æ–¹å¼è¿è¡Œcalico podï¼Œè¿™æ ·å„ä¸ªèŠ‚ç‚¹çš„podå°±å¯ä»¥é€šè¿‡è™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡äº†ã€‚</p>
<h2 id="æœ€åè¯´å‡ å¥">æœ€åè¯´å‡ å¥</h2>
<p>ä»¥ä¸Šå°±åŸºæœ¬å®Œæˆäº†K8sé›†ç¾¤çš„æ­å»ºï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥å®‰è£…metrics serverä»¥æä¾›å„ä¸ªèŠ‚ç‚¹çš„Cpuä¸Memèµ„æºä¿¡æ¯</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash 07_install_metrics_server.sh
</code></pre></div><p>å½“ç„¶ï¼Œæ–‡ä¸­æ‰€æåˆ°çš„é—®é¢˜å¹¶ä¸æ˜¯å…¨éƒ¨ï¼Œå…¶ä»–è¯¸å¦‚å®‰è£…metric serveræ—¶çš„é”™è¯¯ï¼š</p>
<pre><code>metric-server : TLS handshake error from 20.99.219.64:57467: EOF
</code></pre><p>éœ€è¦é€šè¿‡ä¿®æ”¹metric server deploymentçš„å¯åŠ¨å‚æ•°è§£å†³</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">- <span class="nt">args</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- --<span class="l">kubelet-insecure-tls</span><span class="w">
</span><span class="w">    </span>- --<span class="l">kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><span class="w">
</span></code></pre></div><p>å¦‚æœæœ‰å…¶ä»–é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿åœ¨<a class="link" href="https://github.com/kagaya85/K8sTakeOff/issues"  target="_blank" rel="noopener"
    >è¿™é‡Œ</a>æäº¤issueäº¤æµã€‚</p>
<p>æœ€åï¼š</p>
<p><strong>Kill Docker And Long Live Kubernetes!!!</strong></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/kubernetes/">Kubernetes</a>
        
            <a href="/tags/containerd/">Containerd</a>
        
            <a href="/tags/config/">Config</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/2020/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2%E6%9C%AC%E5%9C%B0wordpress%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">
        
        
            <div class="article-image">
                <img src="/p/2020/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2%E6%9C%AC%E5%9C%B0wordpress%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/CleanShot.554a537773fb716fd864252849e26e3c_hue470a64b4465831dfaa5ecda4dac4eb4_424026_250x150_fill_box_smart1_2.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-VUpTd3P7cW/YZCUoSeJuPA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ä½¿ç”¨Dockeréƒ¨ç½²æœ¬åœ°Wordpresså¼€å‘ç¯å¢ƒ</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/2021/amazing-go-interface/">
        
        
            <div class="article-image">
                <img src="/p/2021/amazing-go-interface/golang.a4569e34ee3c8189513108a2f7bedc42_huf1cd1c1b59220aee6296caa95cb97389_220526_250x150_fill_q75_box_smart1.jpeg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-pFaeNO48gYlRMQii977cQg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Amazing Go Interface</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/2021/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%BD%B1%E5%93%8D%E4%B8%8E%E5%BA%94%E7%94%A8/">
        
        
            <div class="article-image">
                <img src="/p/2021/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%BD%B1%E5%93%8D%E4%B8%8E%E5%BA%94%E7%94%A8/87461089_p1.6070a430e42cf2e95d720bb561ce38b0_hufdde9e8b983bf6af308db93c404c60c9_5864242_250x150_fill_box_smart1_2.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-YHCkMOQs8uldcgu1Yc44sA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">å‡½æ•°å¼ç¨‹åºè®¾è®¡çš„å½±å“ä¸åº”ç”¨</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/2019/deepclone%E6%B7%B1%E5%85%8B%E9%9A%86/">
        
        
            <div class="article-image">
                <img src="/p/2019/deepclone%E6%B7%B1%E5%85%8B%E9%9A%86/asuka.b5ca95b84116ef5ce2456ceb92e52d80_hu68cee4137d946c56465103791d37290e_1192700_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-tcqVuEEW71ziRWzrkuUtgA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">DeepCloneæ·±å…‹éš†</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/2019/unix%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E9%94%81/">
        
        
            <div class="article-image">
                <img src="/p/2019/unix%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E9%94%81/81377457_p2.5584b6cb1e2cc2c5227c87c0d3770dd9_hudbcdd69a41f55724887045d593c3afc0_3384791_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-VYS2yx4swsUifIfA03cN2Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Unixç³»ç»Ÿåˆ†æâ€”â€”é”</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kagayablog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2021 ã‹ãŒã‚„ã®éƒ¨å±‹
    </section>
    
    <section class="powerby">
        
            Let's code the fantastic world!!! <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >
            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
